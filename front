import React, { useState } from 'react';
import { FormControl, InputLabel, MenuItem, Select, Button } from '@mui/material';
import { PieChart } from '@mui/x-charts/PieChart';
import axios from 'axios';

function App() {
  const [selection, setSelection] = useState('');
  const [chartData, setChartData] = useState(null);

  const handleSelectionChange = (event) => {
    setSelection(event.target.value);
  };

  const handleSubmit = async () => {
    try {
      const response = await axios.post('/submit', { selection });

      if (response.status !== 200) {
        throw new Error('Network response was not ok');
      }

      const data = response.data.map((item, index) => ({
        id: index,
        value: item.value,
        label: item.id
      }));

      setChartData([{ data }]);
    } catch (error) {
      console.error('Error:', error);
    }
  };

  return (
    <div>
      <FormControl fullWidth>
        <InputLabel id="selection-label">Select</InputLabel>
        <Select
          labelId="selection-label"
          id="selection"
          value={selection}
          label="Select"
          onChange={handleSelectionChange}
        >
          <MenuItem value="region">Region</MenuItem>
          <MenuItem value="server">Server</MenuItem>
        </Select>
      </FormControl>
      <Button variant="contained" onClick={handleSubmit}>Submit</Button>
      {chartData && <PieChart series={chartData} width={400} height={200} />}
    </div>
  );
}

export default App;
