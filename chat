import React, { useState, useEffect } from 'react';
import { BarChart } from '@mui/x-charts/BarChart';

export default function StackBars() {
  const [selectedCountries, setSelectedCountries] = useState({
    london: true,
    paris: true,
    newYork: true,
    seoul: true,
  });

  const [series, setSeries] = useState([]);

  const data = [
    { london: 0, paris: 1, newYork: 2, seoul: 0, vendor: 'cds' },
    { london: 2, paris: 0, newYork: 0, seoul: 3, vendor: 'snps' },
    { london: 1, paris: 3, newYork: 2, seoul: 1, vendor: 'ansys' },
  ];

  useEffect(() => {
    const updatedSeries = [];
    Object.keys(selectedCountries).forEach((country) => {
      if (selectedCountries[country]) {
        updatedSeries.push({
          dataKey: country,
          label: country.charAt(0).toUpperCase() + country.slice(1),
          stack: 'total',
        });
      }
    });
    setSeries(updatedSeries);
  }, [selectedCountries]);

  const handleCheckboxChange = (country) => {
    setSelectedCountries({
      ...selectedCountries,
      [country]: !selectedCountries[country],
    });
  };

  const filteredData = data.map((item) => {
    const filteredItem = {};
    Object.keys(item).forEach((key) => {
      if (key !== 'vendor' && selectedCountries[key]) {
        filteredItem[key] = item[key];
      }
    });
    return { ...filteredItem, vendor: item.vendor };
  });

  return (
    <div>
      <div>
        {Object.keys(selectedCountries).map((country) => (
          <label key={country}>
            <input
              type="checkbox"
              checked={selectedCountries[country]}
              onChange={() => handleCheckboxChange(country)}
            />
            {country}
          </label>
        ))}
      </div>
      <BarChart
        dataset={filteredData}
        xAxis={[{ scaleType: 'band', dataKey: 'vendor' }]}
        series={series}
        width={600}
        height={350}
      />
    </div>
  );
}
