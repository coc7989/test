pipeline {
    agent {
        label 'Production'
    }
    
    parameters {
        string(defaultValue: '', description: 'Build number', name: 'BUILD_NUMBER')
        string(defaultValue: '', description: 'Map license', name: 'MAPPED_LICENSE')
        string(defaultValue: '', description: 'Vendor', name: 'VENDOR')
    }
    
    stages {
        stage('Prepare and Transfer Files') {
            steps {
                script {
                    sh """
                        echo "${params.BUILD_NUMBER}:${params.MAPPED_LICENSE}:${params.VENDOR}" > build_license.txt &&
                        scp build_license.txt fllvflamesai.itg.ti.com:/path/to/remote/directory/
                    """
                }
            }
        }
        
        stage('Remote Commands') {
            steps {
                script {
                    sh """
                        ssh -tt fllvflamesai.itg.ti.com '/bin/bash' << 'EOF'
                        content=$(cat /path/to/remote/directory/build_license.txt)
                        IFS=':' read -r build_num mapped_license vendor <<< "$content"
                        echo $SHELL
                        echo "Map license: $mapped_license"
                        echo "Build: $build_num"
                        echo "Vendor: $vendor"
                        EOF
                    """
                }
            }
        }
    }
}
