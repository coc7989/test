pipeline {
    agent any

    environment {
        MAPPED_LICENSE = "snps.fllvflamesai.lic"
    }

    stages {
        stage('Extract Vendor') {
            steps {
                script {
                    // Extract vendor from MAPPED_LICENSE
                    def vendor = MAPPED_LICENSE.split('\\.')[0]

                    echo "Vendor: ${vendor}"

                    // Check if vendor is 'snps'
                    if (vendor == 'snps') {
                        // Execute the script and capture output
                        def scriptOutput = sh(script: 'your_script_here', returnStdout: true).trim()

                        echo "Script Output: ${scriptOutput}"

                        // Parse for FAILED in the script output
                        def verificationStatus = scriptOutput.contains('FAILED') ? 'FAILED' : 'PASSED'

                        echo "Verification Status: ${verificationStatus}"

                        // Check verification status
                        if (verificationStatus == 'FAILED') {
                            error "Verification failed. Stopping the pipeline."
                        }
                    } else {
                        echo "Vendor is not 'snps'. Skipping script execution."
                    }
                }
            }
        }
        stage('Further Steps') {
            steps {
                echo "This will not be executed if verification fails."
            }
        }
    }

    post {
        always {
            echo "Pipeline finished."
        }
        failure {
            echo "Pipeline failed."
        }
    }
}
