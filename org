from flask import Flask, request, jsonify
import os
import re

app = Flask(__name__)

@app.route('/search_feature', methods=['POST'])
def search_feature():
    feature_name = request.json.get('feature_name')
    feature_array = []

    # Iterate through files in the directory
    data_path = "/home/flames/data"
    for filename in os.listdir(data_path):
        filepath = os.path.join(data_path, filename)
        if os.path.isfile(filepath):
            with open(filepath, 'r') as file:
                for line in file:
                    # Search for lines containing the feature name
                    if feature_name in line:
                        # Extract count number and server name
                        match = re.search(r'{"server_name": "([^"]+)", "feature_name":"([^"]+)", "total_count":(\d+)}', line)
                        if match:
                            server_name = match.group(1)
                            count = int(match.group(3))
                            # Add to featureArray
                            feature_array.append({"server_name": server_name, "feature_name": feature_name, "total_count": count})

    return jsonify(feature_array)

if __name__ == '__main__':
    app.run(debug=True)
