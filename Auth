from flask import Flask, request, jsonify
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText

app = Flask(__name__)

def format_row_data_as_table(row_data):
    table_html = "<table border='1'><tr>"
    headers = row_data[0].keys()
    for header in headers:
        table_html += f"<th>{header}</th>"
    table_html += "</tr>"
    for row in row_data:
        table_html += "<tr>"
        for value in row.values():
            table_html += f"<td>{value}</td>"
        table_html += "</tr>"
    table_html += "</table>"
    return table_html

@app.route('/send-mail', methods=['POST'])
def send_mail():
    data = request.json
    to = data['to']
    subject = data['subject']
    body = data['body']
    row_data = data['rowData']

    # Format rowData as HTML table
    table_html = format_row_data_as_table(row_data)

    # Attach the formatted table to the body
    body += f'\n\n{table_html}'

    # Construct email message
    msg = MIMEMultipart()
    msg.attach(MIMEText(body, 'html'))
    msg['From'] = 'your_email@example.com'
    msg['To'] = to
    msg['Subject'] = subject

    # Replace 'smtp_server', 'port', 'your_email', and 'your_password' with your SMTP server details
    try:
        with smtplib.SMTP('smtp_server', port) as server:
            server.starttls()
            server.login('your_email', 'your_password')
            server.sendmail('your_email', to, msg.as_string())

        return jsonify({'message': 'Mail sent successfully'})
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)


rowData: [
          {
            color: "purple",
            type: "minivan",
            registration: new Date('2012-02-03'),
            capacity: 7
          },
          {
            color: "red",
            type: "truck",
            registration: new Date('2002-07-01'),
            capacity: 9
          }
        ]
      });
