from flask import Flask, request, jsonify
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

app = Flask(__name__)

@app.route('/send_email', methods=['POST'])
def send_email():
    data = request.json
    to_email = data.get('to')
    subject = data.get('subject')
    body = data.get('body')

    # Email configurations
    sender_email = 'your_email@example.com'  # Your email address
    smtp_server = 'your_smtp_server.example.com'  # Your SMTP server address
    smtp_port = 25  # SMTP port (usually 25 for unencrypted connections)

    # Create message container - the correct MIME type is multipart/alternative.
    msg = MIMEMultipart()
    msg['From'] = sender_email
    msg['To'] = to_email
    msg['Subject'] = subject

    # Attach the message body
    msg.attach(MIMEText(body, 'plain'))

    try:
        # Create SMTP session
        server = smtplib.SMTP(smtp_server, smtp_port)
        # Send the email
        server.sendmail(sender_email, to_email, msg.as_string())
        # Terminate the SMTP session
        server.quit()
        return jsonify({'message': 'Email sent successfully!'}), 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
