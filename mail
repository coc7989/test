import hudson.model.Computer

node {
    def offlineNodes = []
    
    // Check each node's online status
    for (node in Jenkins.instance.computers) {
        if (node.offline) {
            offlineNodes.add(node.name)
        }
    }
    
    // Send an email if any nodes are offline
    if (!offlineNodes.isEmpty()) {
        def offlineNodeList = offlineNodes.join(', ')
        
        // Print to console for debugging
        echo "Offline nodes: ${offlineNodeList}"
        
        // Send email notification
        emailext (
            subject: "Jenkins Alert: Offline Nodes Detected",
            body: """Hello Admin,
            
The following Jenkins nodes are currently offline:
${offlineNodeList}

Please check the status of these nodes to ensure they are operational.

Best regards,
Jenkins Monitoring System
""",
            to: "admin@gmajl.com"
        )
    } else {
        echo "All nodes are online."
    }
}
