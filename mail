yExcellent point ‚Äî simply using diff between the before and after bjobs output isn't sufficient, because naturally completed jobs will disappear from the bjobs output (which only shows pending/running jobs by default). So, you need to account for:

Jobs that completed normally (exit code 0 or as expected)

Jobs that failed or were killed due to the infra activity



---

‚úÖ Refined Monitoring Plan

Here‚Äôs how to enhance your process to track completed vs failed jobs accurately:


---

üîπ 1. Capture bjobs -a Before and After

Use -a flag to include recently finished jobs:

bjobs -a -u all | grep designuser > bjobs_before.txt

Same after upgrade:

bjobs -a -u all | grep designuser > bjobs_after.txt

This includes jobs in DONE, EXIT, and PEND/RUN states.


---

üîπ 2. Track Job Completion & Exit Status

Capture key fields for all jobs (especially job ID, user, status, and exit code if available):

bjobs -a -u all -o "jobid user stat exit_code exec_host queue submit_time" | grep designuser > full_jobs_before.txt

Then after upgrade:

bjobs -a -u all -o "jobid user stat exit_code exec_host queue submit_time" | grep designuser > full_jobs_after.txt


---

üîπ 3. Check for Abnormal Terminations

You're mainly looking for:

Jobs in EXIT state with non-zero exit code

Jobs that were RUN before, but are now missing and not in DONE/EXIT

Jobs that failed immediately after activity


You can use a script or logic like:

# Extract job IDs before and after
cut -d' ' -f1 full_jobs_before.txt > job_ids_before.txt
cut -d' ' -f1 full_jobs_after.txt > job_ids_after.txt

# Find jobs that were in before but missing after
comm -23 <(sort job_ids_before.txt) <(sort job_ids_after.txt) > missing_jobs.txt

Then for each job in missing_jobs.txt, use:

bhist -l <job_id>

To check:

Was it completed (DONE)?

Was it killed or failed (EXIT with code ‚â† 0)?

Did it die due to host issue?



---

üîπ 4. Use bhist to Audit Any Suspect Jobs

bhist -u designuser -t MM/DD/YYYY  # Add date/time window around activity

Filter by:

Exited with non-zero status

Killed or Terminated unexpectedly



---

‚úÖ Summary of What to Look For

Check	What It Means

DONE status	Job completed normally ‚úÖ
EXIT + exit code 0	Also OK (some tools exit with code 0 on cancel) ‚úÖ
EXIT + exit code ‚â† 0	‚ö†Ô∏è Check bhist ‚Äî possible failure
Missing from bjobs + found in bhist as DONE	OK
Missing from both	‚ö†Ô∏è Check logs ‚Äî may have been lost or not tracked
RUN before but never reached DONE/EXIT	‚ö†Ô∏è Suspicious ‚Äî check daemon/host logs



---

Let me know if you'd like a script to automate the before/after comparison and detect job failures with summaries. I can help with that too.

