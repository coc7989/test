from flask import Flask, request, jsonify
import cx_Oracle

app = Flask(__name__)

# Oracle database connection
dsn = cx_Oracle.makedsn("hostname", "port", sid="your_sid")
connection = cx_Oracle.connect(user="your_username", password="your_password", dsn=dsn)

@app.route('/get_user_data', methods=['POST'])
def get_user_data():
    try:
        # Get the user ID from the request body
        data = request.json
        user_id = data.get('user_id')

        if not user_id:
            return jsonify({"error": "user_id is required"}), 400

        # Query the Oracle database
        cursor = connection.cursor()
        query = """
            SELECT pend_time, run_time, job_efficiency 
            FROM your_table_name 
            WHERE user_id = :user_id
        """
        cursor.execute(query, user_id=user_id)
        result = cursor.fetchone()

        if result:
            pend_time, run_time, job_efficiency = result
            return jsonify({
                "user_id": user_id,
                "pend_time": pend_time,
                "run_time": run_time,
                "job_efficiency": job_efficiency
            })
        else:
            return jsonify({"error": "User not found"}), 404

    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
