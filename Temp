from flask import Flask, request, jsonify
import cx_Oracle

app = Flask(__name__)

# Database connection setup
dsn_tns = cx_Oracle.makedsn('host', 'port', service_name='service_name')
conn = cx_Oracle.connect(user='username', password='password', dsn=dsn_tns)

@app.route('/check_restore', methods=['GET'])
def check_restore():
    cursor = conn.cursor()
    cursor.execute("SELECT restored FROM restore_state WHERE user_id = :user_id", [request.args.get('user_id')])
    result = cursor.fetchone()
    restored = result[0] if result else False
    return jsonify({'restored': restored})

@app.route('/restore', methods=['POST'])
def restore():
    cursor = conn.cursor()
    # Perform restore operation
    try:
        # Example restore operation
        cursor.execute("UPDATE restore_state SET restored = 1 WHERE user_id = :user_id", [request.json['user_id']])
        conn.commit()
        return jsonify({'message': 'Restore successful'}), 200
    except Exception as e:
        conn.rollback()
        return jsonify({'message': 'Restore failed', 'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)
